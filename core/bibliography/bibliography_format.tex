% This file contains all of the code that formats the bibliography. Since be package ›biblatex‹ is used, the bibliography needs to be compiled with ›biber‹.
%
% This file contains the following parts:
%   • Resources
%   • Redefined Keywords
%   • Coloring
%   • Format of the Entries
%   • Format of the Own Publications


\usepackage
[
    sortcites,              % Sort multiple references when citing them together.
    style = alphabetic,     % The style of a citation mark.
    defernumbers,           % Makes sure that references always have unique numbers. This is important if you use multiple bibliographies.
    safeinputenc,           % Allows to use UTF8 characters in the bibliography and tries to translate them into TeX automatically.
    backref = true,         % Creates back references in the bibliography.
    backrefstyle = three,   % Compresses three or more consecutive pages in the back references into a range.
    hyperref = true,        % Makes links generated by biblatex clickable. If hyperref is not used, a warning is issued.
    maxbibnames = 99,       % The maximum number of names displayed in the bibliography.
    maxcitenames = 2,       % The maximum number of names displayed when using commands like ›textcite‹. The default is 3. After that, ›et al.‹ is used.
%    useprefix,              % Prints name prefixes, such as ›von‹. The default is false. This means that prefixes are not considered to be part of the last name.
]
{biblatex} % Used in order to format the bibliography.

% The following command changes the space between the list of authors and the citation mark into a non-breaking space.
\renewcommand\namelabeldelim{\addnbspace}


%%%%%%%%%%%%%%%
%% Resources %%
%%%%%%%%%%%%%%%

\addbibresource{references/strings.bib}                     % Contains many strings for common conference names etc. These strings can then be used in the references.
\addbibresource{references/references.bib}                  % The file that contains the references that are used for the thesis.


%%%%%%%%%%%%%%%%%%%%%%%%
%% Redefined Keywords %%
%%%%%%%%%%%%%%%%%%%%%%%%

\renewbibmacro{in:}%
{%
    \ifentrytype{article}{}{\printtext{\bibstring{in}\intitlepunct}}%
}
% \renewcommand*{\volumenumberdelim}{\addcolon}

\renewbibmacro*{volume+number+eid}%
{%
    \printfield{volume}%
    \iffieldundef{number}{}{\addcolon}%
    %  \setunit*{\addnbthinspace}%
    \printfield{number}%
    \setunit*{\addcomma\space}%
    \printfield{eid}%
}

\DefineBibliographyStrings{english}%
{%
    backrefpage  = {\lowercase{s}ee page}, % For a single page number.
    backrefpages = {\lowercase{s}ee pages} % For multiple page numbers.
}


%%%%%%%%%%%%%%
%% Coloring %%
%%%%%%%%%%%%%%

\DeclareFieldFormat[article]{title}{\textbf{\color{stroke1}#1}}
\DeclareFieldFormat[inproceedings]{title}{\textbf{\color{stroke1}#1}}
\DeclareFieldFormat[thesis]{title}{\textbf{\color{stroke1}#1}}
\DeclareFieldFormat[book]{title}{\textbf{\color{stroke1}#1}}
\DeclareFieldFormat[unpublished]{title}{\textbf{\color{stroke1}#1}}
\DeclareFieldFormat[report]{title}{\textbf{\color{stroke1}#1}}
\DeclareFieldFormat[inbook]{chapter}{\textbf{\color{stroke1}#1}}
\DeclareFieldFormat[inbook]{title}{#1}
\DeclareFieldFormat{pages}{#1}


%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Format of the Entries %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%

% The following toggle defines how the citation mark formats the author names. If this toggle is true, more information is used.
\newtoggle{authorend}
\togglefalse{authorend}

% Article
\DeclareBibliographyDriver{article}%
{%
  \usebibmacro{bibindex}%
  \usebibmacro{begentry}%
  \iftoggle{authorend}{}{\usebibmacro{author/translator+others}}%
  \setunit{\labelnamepunct}\newblock
  \usebibmacro{title}%
  \newunit
  \printlist{language}%
  \newunit\newblock
  \usebibmacro{byauthor}%
  \newunit\newblock
  \usebibmacro{bytranslator+others}%
  \newunit\newblock
  \printfield{version}%
  \newunit\newblock
  \usebibmacro{in:}%
  \usebibmacro{journal+issuetitle}%
  \newunit
  \usebibmacro{byeditor+others}%
  \newunit
  \usebibmacro{note+pages}%
  \newunit\newblock
  \iftoggle{bbx:isbn}
  {\printfield{issn}}
  {}%
  \newunit\newblock
  \usebibmacro{doi+eprint+url}%
  \newunit\newblock
  \usebibmacro{addendum+pubstate}%
  \setunit{\bibpagerefpunct}\newblock
  \usebibmacro{pageref}%
  \newunit\newblock
  \iftoggle{bbx:related}
  {\usebibmacro{related:init}%
    \usebibmacro{related}}
  {}%
  \usebibmacro{finentry}%
  \iftoggle{authorend}{\usebibmacro{author/translator+others}}{}%
}

% Book Chapter
\DeclareBibliographyDriver{inbook}%
{%
  \usebibmacro{bibindex}%
  \usebibmacro{begentry}%
  \iftoggle{authorend}{}{\usebibmacro{author/translator+others}}%
  \setunit{\labelnamepunct}\newblock
  % \usebibmacro{title}%
  \usebibmacro{chapter+pages}%
  % \printfield{chapter}%
  \newunit
  \printlist{language}%
  \newunit\newblock
  \usebibmacro{byauthor}%
  \newunit\newblock
  \usebibmacro{in:}%
  \usebibmacro{bybookauthor}%
  \newunit\newblock
  \usebibmacro{maintitle+booktitle}%
  \newunit\newblock
  \usebibmacro{byeditor+others}%
  \newunit\newblock
  \printfield{edition}%
  \newunit
  \iffieldundef{maintitle}
  {\printfield{volume}%
    \printfield{part}}
  {}%
  \newunit
  \printfield{volumes}%
  \newunit\newblock
  \usebibmacro{series+number}%
  \newunit\newblock
  \printfield{note}%
  \newunit\newblock
  \usebibmacro{publisher+location+date}%
  \newunit\newblock
  % \usebibmacro{chapter+pages}%
  \newunit\newblock
  \iftoggle{bbx:isbn}
  {\printfield{isbn}}
  {}%
  \newunit\newblock
  \usebibmacro{doi+eprint+url}%
  \newunit\newblock
  \usebibmacro{addendum+pubstate}%
  \setunit{\bibpagerefpunct}\newblock
  \usebibmacro{pageref}%
  \newunit\newblock
  \iftoggle{bbx:related}
  {\usebibmacro{related:init}%
    \usebibmacro{related}}
  {}%
  \usebibmacro{finentry}%
  \iftoggle{authorend}{\usebibmacro{author/translator+others}}{}%
}

% Proceedings Article
\DeclareBibliographyDriver{inproceedings}%
{%
  \usebibmacro{bibindex}%
  \usebibmacro{begentry}%
  \iftoggle{authorend}{}{\usebibmacro{author/translator+others}}%
  \setunit{\labelnamepunct}\newblock
  \usebibmacro{title}%
  \newunit
  \printlist{language}%
  \newunit\newblock
  \usebibmacro{byauthor}%
  \newunit\newblock
  \usebibmacro{in:}%
  \usebibmacro{maintitle+booktitle}%
  \newunit\newblock
  \usebibmacro{event+venue+date}%
  \newunit\newblock
  \usebibmacro{byeditor+others}%
  \newunit\newblock
  \iffieldundef{maintitle}
  {\printfield{volume}%
    \printfield{part}}
  {}%
  \newunit
  \printfield{volumes}%
  \newunit\newblock
  \usebibmacro{series+number}%
  \newunit\newblock
  \printfield{note}%
  \newunit\newblock
  \printlist{organization}%
  \newunit
  \usebibmacro{publisher+location+date}%
  \newunit\newblock
  \usebibmacro{chapter+pages}%
  \newunit\newblock
  \iftoggle{bbx:isbn}
  {\printfield{isbn}}
  {}%
  \newunit\newblock
  \usebibmacro{doi+eprint+url}%
  \newunit\newblock
  \usebibmacro{addendum+pubstate}%
  \setunit{\bibpagerefpunct}\newblock
  \usebibmacro{pageref}%
  \newunit\newblock
  \iftoggle{bbx:related}
  {\usebibmacro{related:init}%
    \usebibmacro{related}}
  {}%
  \usebibmacro{finentry}%
  \iftoggle{authorend}{\usebibmacro{author/translator+others}}{}%
}

% Thesis
\DeclareBibliographyDriver{thesis}%
{%
  \usebibmacro{bibindex}%
  \usebibmacro{begentry}%
  \iftoggle{authorend}{}{\usebibmacro{author}}%
  \setunit{\labelnamepunct}\newblock
  \usebibmacro{title}%
  \newunit
  \printlist{language}%
  \newunit\newblock
  \usebibmacro{byauthor}%
  \newunit\newblock
  \printfield{note}%
  \newunit\newblock
  \printfield{type}%
  \newunit
  \usebibmacro{institution+location+date}%
  \newunit\newblock
  \usebibmacro{chapter+pages}%
  \newunit
  \printfield{pagetotal}%
  \newunit\newblock
  \iftoggle{bbx:isbn}
  {\printfield{isbn}}
  {}%
  \newunit\newblock
  \usebibmacro{doi+eprint+url}%
  \newunit\newblock
  \usebibmacro{addendum+pubstate}%
  \setunit{\bibpagerefpunct}\newblock
  \usebibmacro{pageref}%
  \newunit\newblock
  \iftoggle{bbx:related}
  {\usebibmacro{related:init}%
    \usebibmacro{related}}
  {}%
  \usebibmacro{finentry}%
  \iftoggle{authorend}{\usebibmacro{author}}{}%
}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Format of the Own Publications %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% The own publications are formatted using a numeric list, whereas the bibliography of the thesis uses an alphanumeric style.

% Copied from numeric.cbx in order to imitate numerical citations.
\providebool{bbx:subentry}
\newbibmacro*{citenum}%
{% Note: the original macro was called ›cite‹. I did not redefine ›cite‹ but instead defined a new macro ›citenum‹ because the author-year citations use the ›cite‹ macro too. Using ›\renewbibmacro*{cite}‹ would have caused all the author-year citations to become numeric too.
  \printtext[bibhyperref]{% If you ever want to use hyperref.
    \printfield{prefixnumber}%
    \printfield{labelnumber}%
    \ifbool{bbx:subentry}
    {\printfield{entrysetcount}}
    {}}%
}

% Copied from numeric.cbx to define a new numeric citation command for @online entries.
\DeclareCiteCommand{\conline}[\mkbibbrackets]
{\usebibmacro{prenote}}
{\usebibmacro{citeindex}%
  \usebibmacro{citenum}}% Note: this was originally "cite" but I changed it to "citenum" to avoid clashes with the author-year style.
{\multicitedelim}
{\usebibmacro{postnote}}